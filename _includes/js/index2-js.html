{% assign feature-items = site.data.index-carousel %}
{% assign items = site.data.mhs-catalog | concat: site.data.ipa-mhs-archives %}
<script>

    /* add item data */
    // objectid,alt,title,text,btn,link,priority
    var featureItems = [
        {% for i in feature-items %}{% assign meta = items | where: 'objectid', i.objectid | first %}
        {% capture object_location %}{% if meta.object_location contains 'youtu' %}{% assign youtube_id = meta.object_location | split: '/' | last %}https://www.youtube-nocookie.com/embed/{{ youtube_id }}?rel=0&modestbranding=1{% else %}{{ meta.object_location | relative_url }}{% endif %}{% endcapture %}
        { 
            "id": "{{ i.objectid }}",
            "object_location": "{{ object_location }}", 
            "image_thumb": "{{ meta.image_thumb | relative_url }}", 
            "image_small": "{{ meta.image_small | relative_url }}", 
            "display_template": "{{ meta.display_template }}",
            "alt": {{ i.alt | default: meta.description | jsonify }}, 
            "title": {{ i.title | default: meta.title | jsonify }}, 
            "text": {{ i.text | default: meta.description | jsonify }}, 
            "btn": {{ i.btn | default: 'View Item' | jsonify }}, 
            "link": "{% if i.link %}{{ i.link | relative_url }}{% else %}{{ '/items/' | relative_url }}{% if meta.parentid %}{{ meta.parentid }}.html#{{ meta.objectid }}{% else %}{{ meta.objectid }}.html{% endif %}{% endif %}" 
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
    ];
    
    /* shuffle items */
    featureItems.sort(function() { return 0.5 - Math.random() });
    /* Sort the array, putting priority items first */
    featureItems.sort((a, b) => {
        // If both items have the same value, maintain original order
        if (a.priority === b.priority) {
            return 0;
        }
        // Prioritize items with priority true
        return a.priority == "true" ? -1 : 1;
    });
    
    // create feature cards
    var cards = "";
    featureItems.forEach((item) => {
        // build each card and modal
        if (item.display_template == "video") {
            var cardBody = `<div class="ratio ratio-16x9 mb-3">
                    <iframe title="video embed ${ item.title }" src="${ item.object_location }" allowfullscreen></iframe>
                </div>
                <p>${ item.text }</p>`;
        } else {
            var cardBody = `<div class="mb-3 text-center">
                    <img src="${ item.image_small }" class="img-fluid" alt="${ item.alt }">
                </div>
                <p>${ item.text }</p>
                <p class="text-center"><a href="${ item.link }" class="btn btn-lg btn-info">${ item.btn }</a></p>`;

        }
        var itemCard = `<div class="col">
                <div class="card h-100 border-info border-3 feature-card ratio ratio-1x1" style="background-image: url(${ item.image_small });">
                    <div class="card-body text-center">
                        <div class="h-100 d-flex flex-column justify-content-center">
                            <div class="bg-dark bg-opacity-75 rounded my-5 mx-3 p-3">
                                <a href="#" role="button" data-bs-toggle="modal" data-bs-target="#${ item.id }Modal" class="text-white stretched-link">${ item.title }</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="${ item.id }Modal" tabindex="-1" aria-labelledby="${ item.id }ModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="${ item.id }ModalLabel">${ item.title }</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                ${ cardBody }
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        cards += itemCard;
    });
    // add to page
    var feature = document.getElementById("feature");
    feature.innerHTML = cards;
    
</script>