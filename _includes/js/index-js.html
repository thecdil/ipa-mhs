{% assign carousel-items = site.data.index-carousel | where_exp: 'i', 'i.priority != "video"' %}
{% assign items = site.data.ipa-mhs-archives %}
<script>
    /* add item data */
    // objectid,alt,title,text,btn,link,priority
    var carouselItems = [
        {% for i in carousel-items %}{% assign meta = items | where: 'objectid', i.objectid | first %}
        { 
            "objectid": "{{ i.objectid }}",
            "object_location": "{{ meta.object_location }}", 
            "image_thumb": "{{ meta.image_thumb | relative_url }}", 
            "image_small": "{{ meta.image_small | relative_url }}", 
            "display_template": "{{ meta.display_template }}",
            "alt": {{ i.alt | default: meta.description | jsonify }}, 
            "title": {{ i.title | default: meta.title | jsonify }}, 
            "text": {{ i.text | default: meta.description | jsonify }}, 
            "btn": {{ i.btn | default: 'View Item' | jsonify }}, 
            "link": "{% if i.link %}{{ i.link | relative_url }}{% else %}{{ '/items/' | relative_url }}{% if meta.parentid %}{{ meta.parentid }}.html#{{ meta.objectid }}{% else %}{{ meta.objectid }}.html{% endif %}{% endif %}" 
        }{% unless forloop.last %},{% endunless %}
        
        {% endfor %}
    ];
    
    /* shuffle items */
    carouselItems.sort(function() { return 0.5 - Math.random() });
    /* Sort the array, putting priority items first */
    carouselItems.sort((a, b) => {
        // If both items have the same value, maintain original order
        if (a.priority === b.priority) {
            return 0;
        }
        // Prioritize items with priority true
        return a.priority == "true" ? -1 : 1;
    });

    /* add items to carousel */
    var carousel = document.getElementById("carouselInner");
    var carouselIndicators = document.getElementById("carouselIndicators");
    var slides = "";
    var indicators = "";
    var i;
    for (i=0; i < {{ carousel-items | size }}; i++) { 
        // create indicator 
        indicator = `<button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="${i.toString()}" ${ i == 0 ? 'class="active" aria-current="true" ' : '' }aria-label="Slide ${i.toString()}"></button>`;
        // create slide
        slide = `<div class="carousel-item rounded${ i == 0 ? ' active' : '' }" >
            <img src="${carouselItems[i].object_location}" alt="" class="d-block h-100 m-auto">
            <div class="carousel-caption bg-dark bg-opacity-75 rounded p-3 text-start mb-3">
                <h3 class="text-white py-2">${carouselItems[i].title}</h3>
                <div class="row">
                    <div class="col-md-9">
                    <p class="d-none d-md-block text-white">${carouselItems[i].text}</p>
                    </div>
                    <div class="col-md-3">
                    <p class="text-center"><a href="${carouselItems[i].link}" class="btn btn-lg btn-outline-primary text-white">${carouselItems[i].btn}</a></p>
                    </div>
                </div>
            </div></div>`;
        slides += slide;
        indicators += indicator;
    }
    // add indicators to page 
    carouselIndicators.innerHTML = indicators;
    // add slides to the page
    carousel.innerHTML = slides;
</script>